add a lock for aggregation
